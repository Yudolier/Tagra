<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>TaGra-mini</title>
  <link rel="stylesheet" href="mini03_base.css">
  <link rel="stylesheet" href="mini03_layers.css">
  <!-- Pickrã®ãƒ†ãƒ¼ãƒCSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@simonwep/pickr/dist/themes/classic.min.css"/>
  <!-- Pickrã®JS -->
  <script src="https://cdn.jsdelivr.net/npm/@simonwep/pickr"></script>
</head>
<body>
  <p id="title">TaGra-mini</p>
  <!--ã‚­ãƒ£ãƒ³ãƒã‚¹-->
<div id="workspace">
    <div id="container">
  <div id="canvas-wrapper">
    <!-- drawCanvas ã¯layer[aI].canvasã«ã€‚å‹•çš„ã«è¿½åŠ ã™ã‚‹-->
  </div>
  <!-- cursorCanvasã‚’æœ€å‰é¢ã§ç‹¬ç«‹ã•ã›ã‚‹-->
  <canvas id="cursorCanvas">ã‚«ãƒ¼ã‚½ãƒ«ã‚­ãƒ£ãƒ³ãƒã‚¹</canvas>
</div>
<div id="layer-panel"></div>
</div>
  <hr>
  <!-- ç·šã®å¤ªã•èª¿æ•´ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼/inputã¨ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®å…¥åŠ›ã‚’å—ã‘ä»˜ã‘ã‚‹ã‚‚ã® -->
  <div id="brush-size">
    <label for="brush-width">ãƒ–ãƒ©ã‚·ã‚µã‚¤ã‚º:</label>
    <button id="brush-decrease">-</button>
    <input type="range" id="brush-width" min="1" max="20" value="2">
    <button id="brush-increase"> + </button>
    <span id="brush-size-display">2</span>px
  </div>
  <!--æ¶ˆã—ã‚´ãƒ ã‚µã‚¤ã‚º/åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³-->
  <div id="eraser-block">
    <div id="eraser">
      <label for="eraser-width">æ¶ˆã—ã‚´ãƒ ã‚µã‚¤ã‚º:</label>
      <button id="eraser-decrease">-</button>
      <input type="range" id="eraser-width" min="1" max="40" value="8">
      <button id="eraser-increase">+</button>
      <span id="eraser-size-display">8</span>px
    </div>
    <button id="mode-toggle">æ¶ˆã—ã‚´ãƒ ã«åˆ‡ã‚Šæ›¿ãˆ</button>
  </div>

  <!-- ã‚«ãƒ©ãƒ¼ãƒ”ãƒƒã‚«ãƒ¼&ä¸é€æ˜åº¦ã®html -->
<div id="color-block">
  <input type="color" id="color-picker" value="#000000" />
  <label for="alpha">ä¸é€æ˜åº¦:</label>
    <input type="range" id="alpha" min="0" max="100" value="100">
    <span id="alpha-display">100</span>%<br>
</div>

<script>
//Javascriptã¯bodyã®æœ€ä¸‹éƒ¨ã«æ›¸ãã€‚ã“ã‚Œã¯ã‚­ãƒ£ãƒ³ãƒã‚¹ã¨ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
const wrapper = document.getElementById("canvas-wrapper");
const cursorCanvas = document.getElementById("cursorCanvas");
const cursorCtx = cursorCanvas.getContext("2d");
  //ãƒ–ãƒ©ã‚·ã‚µã‚¤ã‚ºã‚’å–å¾—
  const brushWidthSlider = document.getElementById('brush-width');
  const eraserWidthSlider = document.getElementById('eraser-width');
  const brushSizeDisplay = document.getElementById('brush-size-display');
  const eraserSizeDisplay = document.getElementById('eraser-size-display');
  //ãƒœã‚¿ãƒ³ã‚’å–å¾—
  const brushDecreaseBtn  = document.getElementById('brush-decrease');
  const brushIncreaseBtn  = document.getElementById('brush-increase');
  const eraserDecreaseBtn = document.getElementById('eraser-decrease');
  const eraserIncreaseBtn = document.getElementById('eraser-increase');
  //ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«é–¢é€£ã™ã‚‹å¤‰æ•°
  let layers = [];  //ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã„ã†ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ ¼ç´ã™ã‚‹é…åˆ—
  let activeIndex = 0;  //ä½•ç•ªç›®ã‚’æç”»ä¸­ï¼Ÿ
  //æç”»ãƒ•ãƒ©ã‚°ã¨åº§æ¨™ã®åˆæœŸåŒ–
    let isDrawing = false;
    let isErasing = false;

    let lastX = 0;
    let lastY = 0;
//ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’classã«ã™ã‚‹
//nameä»¥å¤–ã¯å‹æ‰‹ã«æ±ºã¾ã‚‹ï¼ˆlayer.canvasã¨ã‹ã§å¼•ãå‡ºã›ã‚‹ï¼‰
//Layerã¯name(ã¨ã„ã†æ–‡å­—åˆ—),canvas,ctxã‹ã‚‰ãªã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ãªã‚‹ï¼
class Layer {
  constructor(name) {
    this.name = name;
    this.canvas = document.createElement("canvas");
    this.ctx = this.canvas.getContext("2d");
    this.visible = true;
  }
}
function addLayer(wrapper, layers) {
  const index = layers.length + 1;  // â† ä»Šã‹ã‚‰è¿½åŠ ã•ã‚Œã‚‹ãƒ¬ã‚¤ãƒ¤ãƒ¼ç•ªå· 0ç•ªç›®ãŒ1
  const layer = new Layer(`Layer ${index}`);  //ã‚¹ã‚³ãƒ¼ãƒ—ok!
  layer.canvas.style.zIndex = index;
  wrapper.appendChild(layer.canvas);
    // â˜… è¿½åŠ ï¼š wrapper ã¨åŒã˜ãƒ”ã‚¯ã‚»ãƒ«è§£åƒåº¦ã‚’è¨­å®š
    const { clientWidth:w, clientHeight:h } = wrapper;
  layer.canvas.width  = w;
  layer.canvas.height = h;
  layers.push(layer);
  return layer;
}
class LayerManager {
  constructor(wrapper) {
    this.wrapper = wrapper;
    this.cursorCanvas = document.getElementById("cursorCanvas");
    this.layers = [];
    this.AI = 0;
    this.nextId = 1; // åå‰ãŒè¢«ã‚‰ãªã„ã‚ˆã†ã«ã™ã‚‹
  }

  addLayer(name = `Layer ${this.nextId++}`) {
    const layer = new Layer(name);
    const { clientWidth: w, clientHeight: h } = this.wrapper;
    layer.canvas.width = w;
    layer.canvas.height = h;
    layer.canvas.style.zIndex = this.layers.length + 1;
    layer.canvas.style.position = "absolute";
    layer.canvas.style.top = "0";
    layer.canvas.style.left = "0";
    this.wrapper.appendChild(layer.canvas);

    applyBrushStyle(layer.ctx);
    setupEvents(layer);
    attachDrawEvents(layer);

    this.layers.push(layer);
    this.AI = this.layers.length - 1;  //ãƒ¬ã‚¤ãƒ¤ãƒ¼1ã®AIã¯0
    this.renderLayerPanel();
    return layer;
  }

  getActiveLayer() {
    return this.layers[this.AI] ?? null;
  }

  setActive(index) {
    if (index >= 0 && index < this.layers.length) {
      this.AI = index;
      this.renderLayerPanel();
    }else{
      alert("ã‚¨ãƒ©ãƒ¼ï¼šç„¡åŠ¹ãªå€¤ã§ã™ã€‚");
    }
  }

  removeLayer(index) {
    if (this.layers.length <= 1) {
      alert("ã‚¨ãƒ©ãƒ¼ï¼šãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’0æšã«ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚");
      return false;
    }

    const layer = this.layers[index];
    if (!layer) return false;

    detachDrawEvents(layer);  //ãƒã‚°ã‚‰ã›ãªã„ãŸã‚ã«å¿…è¦ãªå‡¦ç†
    this.wrapper.removeChild(layer.canvas);
    this.layers.splice(index, 1);

    if (this.AI >= this.layers.length) {
      this.AI = this.layers.length - 1;
    }
    this.renderLayerPanel();
    return true;
  }

  renameLayer(index, newName) {
    const layer = this.layers[index];
    if (layer) {
      layer.name = newName;
      this.renderLayerPanel();
    }
  }

  toggleVisibility(index) {
    const layer = this.layers[index];
    if (layer) {
      layer.visible = !layer.visible;
      layer.canvas.style.display = layer.visible ? "block" : "none";
    }
  }

  duplicateLayer(index) {
    const original = this.layers[index];
    if (!original) {
    alert(`æŒ‡å®šã•ã‚ŒãŸãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆindex: ${index}ï¼‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚è¤‡è£½ã§ãã¾ã›ã‚“ã€‚`);
    console.error(`duplicateLayer: index ${index} ãŒç„¡åŠ¹ã§ã™ã€‚layers.length = ${this.layers.length}`);
    return null;
  }

    const newLayer = new Layer(`${original.name} copy`);
    newLayer.canvas.width = original.canvas.width;
    newLayer.canvas.height = original.canvas.height;
    newLayer.ctx.drawImage(original.canvas, 0, 0);

    newLayer.canvas.style.zIndex = this.layers.length + 1;
    newLayer.canvas.style.position = "absolute";
    newLayer.canvas.style.top = "0";
    newLayer.canvas.style.left = "0";
    this.wrapper.appendChild(newLayer.canvas);

    applyBrushStyle(newLayer.ctx);
    setupEvents(newLayer);
    attachDrawEvents(newLayer);

    this.layers.push(newLayer);
    this.AI = this.layers.length - 1;
    this.renderLayerPanel();
    return newLayer;
  }

  moveLayer(index, direction) {
    const swapWith = direction === "up" ? index + 1 : index - 1;
    if (swapWith < 0 || swapWith >= this.layers.length) return;

    [this.layers[index], this.layers[swapWith]] = [this.layers[swapWith], this.layers[index]];
    this.renderZIndex();
    this.AI = swapWith;
    this.renderLayerPanel();
  }
//å„ãƒ¬ã‚¤ãƒ¤ãƒ¼ã® z-index ã‚’ã€é…åˆ—ã®é †ç•ªã«å¿œã˜ã¦æ•´ç†ã—ç›´ã™é–¢æ•°(ä¸¦ã³æ›¿ãˆãŸã‚ã¨ã«å‘¼ã¶)
  renderZIndex() {
    this.layers.forEach((layer, i) => {
      layer.canvas.style.zIndex = i + 1;
    });
  }

//layersã‚’mapã§ä»¥ä¸‹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®é…åˆ—ã«å¤‰æ›ï¼ˆã„ã¡ã„ã¡pushã‚’ãƒ«ãƒ¼ãƒ—ã—ãªãã¦ã‚‚ã„ã„ï¼‰
  getLayerList() {
    return this.layers.map((layer, index) => ({
      index,
      name: layer.name,
      visible: layer.visible ?? true,
      active: index === this.AI,
    }));
  }
  renderLayerPanel() {
  const panel = document.getElementById("layer-panel");
  panel.innerHTML = ""; // ä¸€æ—¦ã‚¯ãƒªã‚¢

  // æœ€æ–°ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±ã§ãƒªã‚¹ãƒˆã‚’å†æ§‹ç¯‰
  this.layers.forEach((layer, index) => {
    const item = document.createElement("div");
    item.className = "layer-item";
    item.textContent = layer.name + (index === this.AI ? "ï¼ˆé¸æŠä¸­ï¼‰" : "");

    // ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’é¸æŠã™ã‚‹ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
    item.addEventListener("click", () => {
      this.setActive(index);
      this.renderLayerPanel(); // å†æç”»ã—ã¦é¸æŠè¡¨ç¤ºã‚’æ›´æ–°
    });

    panel.appendChild(item);
  });
}
}




function applyBrushStyle(ctx){
  ctx.lineCap = "round";
  ctx.lineJoin = "round";
}

// ğŸ¨ ãƒšãƒ³ã®å¤ªã•å¤‰æ›´
brushWidthSlider.addEventListener('input', () => {
  if (!isErasing) {
    manager.getActiveLayer().ctx.lineWidth = brushWidthSlider.value;
  }
  brushSizeDisplay.textContent = brushWidthSlider.value;
});

// ğŸ§½ æ¶ˆã—ã‚´ãƒ ã®å¤ªã•å¤‰æ›´
eraserWidthSlider.addEventListener('input', () => {
  if (isErasing) {
    manager.getActiveLayer().ctx.lineWidth = eraserWidthSlider.value;
  }
  eraserSizeDisplay.textContent = eraserWidthSlider.value;
});
//æ¶ˆã—ã‚´ãƒ ãƒ¢ãƒ¼ãƒ‰ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
const modeToggle = document.getElementById('mode-toggle');
modeToggle.addEventListener('click', () => {
  isErasing = !isErasing;  // çŠ¶æ…‹ã‚’åè»¢true or false
  modeToggle.textContent = isErasing ? "ãƒšãƒ³ã«åˆ‡ã‚Šæ›¿ãˆ" : "æ¶ˆã—ã‚´ãƒ ã«åˆ‡ã‚Šæ›¿ãˆ";
  manager.getActiveLayer().ctx.globalCompositeOperation = isErasing
    ? 'destination-out'    // â† æ¶ˆã—ã‚´ãƒ ï¼ˆtrueã®ã¨ãï¼‰
    : 'source-over';       // â† é€šå¸¸ã®æç”»ï¼ˆfalseã®ã¨ãï¼‰
  manager.getActiveLayer().ctx.lineWidth = isErasing ? eraserWidthSlider.value : brushWidthSlider.value; //ãƒ¢ãƒ¼ãƒ‰ã”ã¨ã«ãƒ–ãƒ©ã‚·ã‚µã‚¤ã‚ºã‚’å®šã‚ã‚‹
});
  //ãƒœã‚¿ãƒ³
  // ãƒ–ãƒ©ã‚·ã‚µã‚¤ã‚º Â±1px
brushDecreaseBtn.addEventListener('click', () => {
  let v = parseInt(brushWidthSlider.value, 10); //ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®å€¤(æ–‡å­—åˆ—)ã‚’10é€²æ•°ã«å¤‰æ›
  if (v > parseInt(brushWidthSlider.min, 10)) v--;
  brushWidthSlider.value = v;
  brushSizeDisplay.textContent = v;
  if (!isErasing) manager.getActiveLayer().ctx.lineWidth = v;
});
brushIncreaseBtn.addEventListener('click', () => {
  let v = parseInt(brushWidthSlider.value, 10);
  if (v < parseInt(brushWidthSlider.max, 10)) v++;
  brushWidthSlider.value = v;
  brushSizeDisplay.textContent = v;
  if (!isErasing) manager.getActiveLayer().ctx.lineWidth = v;
});

// æ¶ˆã—ã‚´ãƒ ã‚µã‚¤ã‚º Â±1px
eraserDecreaseBtn.addEventListener('click', () => {
  let v = parseInt(eraserWidthSlider.value, 10);
  if (v > parseInt(eraserWidthSlider.min, 10)) v--;
  eraserWidthSlider.value = v;
  eraserSizeDisplay.textContent = v;
  if (isErasing) manager.getActiveLayer().ctx.lineWidth = v;
});
eraserIncreaseBtn.addEventListener('click', () => {
  let v = parseInt(eraserWidthSlider.value, 10);
  if (v < parseInt(eraserWidthSlider.max, 10)) v++;
  eraserWidthSlider.value = v;
  eraserSizeDisplay.textContent = v;
  if (isErasing) manager.getActiveLayer().ctx.lineWidth = v;
});

// ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®å‡¦ç†ã¯layerã”ã¨ã«å‘¼ã³å‡ºã™ã“ã¨ãŒå¿…è¦
function setupEvents(layer) {
  const canvas = layer.canvas;
  const ctx    = layer.ctx;

  canvas._onPointerDown = function(e){
    // æŠ¼ã•ã‚ŒãŸæ™‚ã«æ›¸ã„ã¦ã‚‹ã‚ˆã¨ãƒ•ãƒ©ã‚°ã‚’ç«‹ã¦ã‚‹
    isDrawing = true;
    [lastX, lastY] = [e.offsetX, e.offsetY];
    canvas.setPointerCapture(e.pointerId); //è¿½åŠ 
  };

  canvas._onPointerMove = function(e){
    // ãƒã‚¦ã‚¹ãŒå‹•ã„ã¦ã‚‹æ™‚å¸¸ã«ï¼ˆãƒ•ãƒ©ã‚°ãŒç«‹ã£ã¦ã„ã‚‹æ™‚ã«isDrawingã§é™å®šï¼‰
    // ã‚«ãƒ¼ã‚½ãƒ«ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
    // â‘  ã¾ãšå‰å›ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æ¶ˆã™
    cursorCtx.clearRect(0, 0, cursorCanvas.width, cursorCanvas.height);
    // â‘¡ ç¾åœ¨ã®ãƒ¢ãƒ¼ãƒ‰ã¨ã‚µã‚¤ã‚ºã‚’å–å¾—
    const size = isErasing
      ? parseInt(eraserWidthSlider.value, 10)
      : parseInt(brushWidthSlider.value, 10);
    const x = e.offsetX, y = e.offsetY;
    // â‘¢ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¨­å®š
    cursorCtx.lineWidth = 1;
    if (isErasing) {
      // æ¶ˆã—ã‚´ãƒ ãƒ¢ãƒ¼ãƒ‰ï¼šåŠé€æ˜ã‚°ãƒ¬ãƒ¼ã§æ ã ã‘
      cursorCtx.strokeStyle = "rgba(0,0,0,0.3)";
    } else {
      // ãƒšãƒ³ãƒ¢ãƒ¼ãƒ‰ï¼šä»Šã®ç·šè‰²ï¼ˆä¸é€æ˜åº¦è¾¼ã¿ï¼‰ã‚’ä½¿ã†
      cursorCtx.strokeStyle = ctx.strokeStyle;
    }
    // â‘£ å††ã‚’æã
    cursorCtx.beginPath();
    cursorCtx.arc(x, y, size / 2, 0, Math.PI * 2);
    cursorCtx.stroke();

    // å®Ÿéš›ã®æç”»ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
    // ãƒ•ãƒ©ã‚°ãŒç«‹ã£ã¦ã„ã‚‹ã®ã§æç”»ãŒãªã•ã‚Œã‚‹
    if (!isDrawing) return;
    ctx.lineWidth   = size;
    // ãƒ–ãƒ©ã‚·å½¢çŠ¶ã®å†ç¢ºèª
    ctx.lineCap     = "round";
    ctx.lineJoin    = "round";
    ctx.beginPath();
    ctx.moveTo(lastX, lastY);
    ctx.lineTo(e.offsetX, e.offsetY);
    ctx.stroke();
    [lastX, lastY] = [e.offsetX, e.offsetY];
  };

  // ãƒã‚¦ã‚¹ã‚’é›¢ã™ã¨æ›¸ã„ã¦ãªã„ã‚ˆã«ãªã£ã¦pointermoveãŒç„¡åŠ¹åŒ–ã•ã‚Œã‚‹ã€‚ã‚«ãƒ¼ã‚½ãƒ«ã‚‚æ¶ˆã™
  // ã‚¢ãƒ­ãƒ¼é–¢æ•°ã‚’ä½¿ç”¨(ç°¡å˜ãªè¨˜æ³•)
  canvas._onPointerUp    = (e) => isDrawing = false;
  canvas._onPointerLeave = (e) => {
    isDrawing = false;
    canvas.releasePointerCapture(e.pointerId); // å®‰å…¨ã«è§£æ”¾
    cursorCtx.clearRect(0, 0, cursorCanvas.width, cursorCanvas.height);
  };
}

// ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’ç™»éŒ²ã™ã‚‹é–¢æ•°
function attachDrawEvents(layer) {
  const canvas = layer.canvas;
  canvas.addEventListener("pointerdown",  canvas._onPointerDown);
  canvas.addEventListener("pointermove",  canvas._onPointerMove);
  canvas.addEventListener("pointerup",    canvas._onPointerUp);
  canvas.addEventListener("pointerleave", canvas._onPointerLeave);
}

// ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’å‰Šé™¤ã™ã‚‹é–¢æ•°
function detachDrawEvents(layer) {
  const canvas = layer.canvas;
  canvas.removeEventListener("pointerdown",  canvas._onPointerDown);
  canvas.removeEventListener("pointermove",  canvas._onPointerMove);
  canvas.removeEventListener("pointerup",    canvas._onPointerUp);
  canvas.removeEventListener("pointerleave", canvas._onPointerLeave);
  // ä¸è¦ã«ãªã£ãŸå‚ç…§ã‚’å‰Šé™¤
  delete canvas._onPointerDown;
  delete canvas._onPointerMove;
  delete canvas._onPointerUp;
  delete canvas._onPointerLeave;
}

  </script>

  <script>// ã‚«ãƒ©ãƒ¼ãƒ”ãƒƒã‚«ãƒ¼ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã€‚
const colorInput = document.getElementById('color-picker');
const alphaInput = document.getElementById('alpha');
const alphaDisplay = document.getElementById('alpha-display');

//åˆæœŸè‰²è¨­å®šã€‚ã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’16é€²æ•°ã‹ã‚‰10é€²æ•°ã«å¤‰æ¡ˆã€ä¸é€æ˜åº¦ã¨åˆæˆã—ã¦rgbaã«ã—ãŸå¾Œã€

function updateBrushColor() {
  const hex = colorInput.value;
  const r = parseInt(hex.slice(1, 3), 16);
  const g = parseInt(hex.slice(3, 5), 16);
  const b = parseInt(hex.slice(5, 7), 16);
  const a = alphaInput.value / 100;

  const rgba = `rgba(${r}, ${g}, ${b}, ${a})`;
  //ç¾åœ¨ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç·šè‰²ã‚’å¤‰æ›´â€»ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒãªã„ã¨ãƒã‚°ã‚‹ã®ã§æ³¨æ„(ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å®Ÿè£…ã‚’æ¤œè¨)
  manager.getActiveLayer().ctx.strokeStyle = rgba;
}

// è‰²ãƒ»ä¸é€æ˜åº¦ã®å¤‰æ›´ã‚¤ãƒ™ãƒ³ãƒˆ
colorInput.addEventListener('input', updateBrushColor);
alphaInput.addEventListener('input', () => {
  alphaDisplay.textContent = alphaInput.value;
  updateBrushColor();
});

//ã‚­ãƒ£ãƒ³ãƒ‘ã‚¹ã‚µã‚¤ã‚ºã‚’å¤‰æ›´ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã€‚wrapperã«ä¾å­˜ã€‚ãƒ•ã‚©ãƒ«ãƒ€å®Ÿè£…æ™‚ã«ã„ã˜ã‚‹å¿…è¦ã‚ã‚Šã€‚
function resizeCanvases() {
  const wrapper = document.getElementById('canvas-wrapper');
  const width = wrapper.clientWidth;
  const height = wrapper.clientHeight;

  const canvases = wrapper.querySelectorAll('canvas');
  canvases.forEach(canvas => {
    canvas.width = width;   // æç”»è§£åƒåº¦ã®è¨­å®šï¼ˆã“ã‚ŒãŒãªã„ã¨ãƒœã‚±ã‚‹ï¼‰
    canvas.height = height;
  });
  cursorCanvas.width = wrapper.clientWidth;
  cursorCanvas.height = wrapper.clientHeight;

}
//ã“ã®ä¸­ã¯htmlã¨cssãŒèª­ã¿è¾¼ã¿çµ‚äº†ã—ã¦ã‹ã‚‰å‹•ã


</script>

<!--DOMå–å¾—ã«é–¢ã‚ã‚‹ã‚³ãƒ¼ãƒ‰-->
<script>
  window.addEventListener('load', () => {
  manager = new LayerManager(wrapper);
  baseLayer = manager.addLayer()
  manager.renderLayerPanel();
  resizeCanvases();
  updateBrushColor(); // ã‚«ãƒ©ãƒ¼ãƒ”ãƒƒã‚«ãƒ¼ã®åˆæœŸåŒ–
});
</script>
</body>
</html>