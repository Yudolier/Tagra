<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>TaGra-mini</title>
  <link rel="stylesheet" href="mini02.css">
  <!-- Pickrã®ãƒ†ãƒ¼ãƒCSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@simonwep/pickr/dist/themes/classic.min.css"/>
  <!-- Pickrã®JS -->
  <script src="https://cdn.jsdelivr.net/npm/@simonwep/pickr"></script>
</head>
<body>
  <p id="title">TaGra-mini ver2.0</p>
  <!--ã‚­ãƒ£ãƒ³ãƒã‚¹-->
  <div id="canvas-wrapper">
    <canvas id="drawCanvas">ã“ã“ã«ã‚­ãƒ£ãƒ³ãƒã‚¹</canvas>
    <canvas id="cursorCanvas"></canvas>
  </div>
  <hr>
  <!-- ç·šã®å¤ªã•èª¿æ•´ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼/inputã¨ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®å…¥åŠ›ã‚’å—ã‘ä»˜ã‘ã‚‹ã‚‚ã® -->
  <div id="brush-size">
    <label for="brush-width">ãƒ–ãƒ©ã‚·ã‚µã‚¤ã‚º:</label>
    <button id="brush-decrease">-</button>
    <input type="range" id="brush-width" min="1" max="20" value="2">
    <button id="brush-increase"> + </button>
    <span id="brush-size-display">2</span>px
  </div>
  <!--æ¶ˆã—ã‚´ãƒ ã‚µã‚¤ã‚º/åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³-->
  <div id="eraser-block">
    <div id="eraser">
      <label for="eraser-width">æ¶ˆã—ã‚´ãƒ ã‚µã‚¤ã‚º:</label>
      <button id="eraser-decrease">-</button>
      <input type="range" id="eraser-width" min="1" max="40" value="8">
      <button id="eraser-increase">+</button>
      <span id="eraser-size-display">8</span>px
    </div>
    <button id="mode-toggle">æ¶ˆã—ã‚´ãƒ ã«åˆ‡ã‚Šæ›¿ãˆ</button>
  </div>

  <!-- ã‚«ãƒ©ãƒ¼ãƒ”ãƒƒã‚«ãƒ¼&ä¸é€æ˜åº¦ã®html -->
<div id="color-block">
  <input type="color" id="color-picker" value="#000000" />
  <label for="alpha">ä¸é€æ˜åº¦:</label>
    <input type="range" id="alpha" min="0" max="100" value="100">
    <span id="alpha-display">100</span>%<br>
</div>

<script>
//Javascriptã¯bodyã®æœ€ä¸‹éƒ¨ã«æ›¸ãã€‚ã“ã‚Œã¯ã‚­ãƒ£ãƒ³ãƒã‚¹ãƒ©ãƒƒãƒ‘ãƒ¼ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
const drawCanvas   = document.getElementById("drawCanvas");
const cursorCanvas = document.getElementById("cursorCanvas");
const drawCtx      = drawCanvas .getContext("2d");
const cursorCtx    = cursorCanvas.getContext("2d");

  //ãƒ–ãƒ©ã‚·ã‚µã‚¤ã‚ºã‚’å–å¾—
  const brushWidthSlider = document.getElementById('brush-width');
  const eraserWidthSlider = document.getElementById('eraser-width');
  const brushSizeDisplay = document.getElementById('brush-size-display');
  const eraserSizeDisplay = document.getElementById('eraser-size-display');
  //ãƒœã‚¿ãƒ³ã‚’å–å¾—
  const brushDecreaseBtn  = document.getElementById('brush-decrease');
  const brushIncreaseBtn  = document.getElementById('brush-increase');
  const eraserDecreaseBtn = document.getElementById('eraser-decrease');
  const eraserIncreaseBtn = document.getElementById('eraser-increase');
  //æç”»ãƒ•ãƒ©ã‚°ã¨åº§æ¨™ã®åˆæœŸåŒ–
    let isDrawing = false;
    let isErasing = false;

    let lastX = 0;
    let lastY = 0;
   // ğŸ¨ ãƒšãƒ³ã®å¤ªã•å¤‰æ›´
brushWidthSlider.addEventListener('input', () => {
  if (!isErasing) {
    drawCtx.lineWidth = brushWidthSlider.value;
  }
  brushSizeDisplay.textContent = brushWidthSlider.value;
});

// ğŸ§½ æ¶ˆã—ã‚´ãƒ ã®å¤ªã•å¤‰æ›´
eraserWidthSlider.addEventListener('input', () => {
  if (isErasing) {
    drawCtx.lineWidth = eraserWidthSlider.value;
  }
  eraserSizeDisplay.textContent = eraserWidthSlider.value;
});
//æ¶ˆã—ã‚´ãƒ ãƒ¢ãƒ¼ãƒ‰ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
const modeToggle = document.getElementById('mode-toggle');
modeToggle.addEventListener('click', () => {
  isErasing = !isErasing;  // çŠ¶æ…‹ã‚’åè»¢true or false
  modeToggle.textContent = isErasing ? "ãƒšãƒ³ã«åˆ‡ã‚Šæ›¿ãˆ" : "æ¶ˆã—ã‚´ãƒ ã«åˆ‡ã‚Šæ›¿ãˆ";
  drawCtx.globalCompositeOperation = isErasing
    ? 'destination-out'    // â† æ¶ˆã—ã‚´ãƒ ï¼ˆtrueã®ã¨ãï¼‰
    : 'source-over';       // â† é€šå¸¸ã®æç”»ï¼ˆfalseã®ã¨ãï¼‰
  drawCtx.lineWidth = isErasing ? eraserWidthSlider.value : brushWidthSlider.value; //ãƒ¢ãƒ¼ãƒ‰ã”ã¨ã«ãƒ–ãƒ©ã‚·ã‚µã‚¤ã‚ºã‚’å®šã‚ã‚‹
});
  //ãƒœã‚¿ãƒ³
  // ãƒ–ãƒ©ã‚·ã‚µã‚¤ã‚º Â±1px
brushDecreaseBtn.addEventListener('click', () => {
  let v = parseInt(brushWidthSlider.value, 10);
  if (v > parseInt(brushWidthSlider.min, 10)) v--;
  brushWidthSlider.value = v;
  brushSizeDisplay.textContent = v;
  if (!isErasing) drawCtx.lineWidth = v;
});
brushIncreaseBtn.addEventListener('click', () => {
  let v = parseInt(brushWidthSlider.value, 10);
  if (v < parseInt(brushWidthSlider.max, 10)) v++;
  brushWidthSlider.value = v;
  brushSizeDisplay.textContent = v;
  if (!isErasing) drawCtx.lineWidth = v;
});

// æ¶ˆã—ã‚´ãƒ ã‚µã‚¤ã‚º Â±1px
eraserDecreaseBtn.addEventListener('click', () => {
  let v = parseInt(eraserWidthSlider.value, 10);
  if (v > parseInt(eraserWidthSlider.min, 10)) v--;
  eraserWidthSlider.value = v;
  eraserSizeDisplay.textContent = v;
  if (isErasing) drawCtx.lineWidth = v;
});
eraserIncreaseBtn.addEventListener('click', () => {
  let v = parseInt(eraserWidthSlider.value, 10);
  if (v < parseInt(eraserWidthSlider.max, 10)) v++;
  eraserWidthSlider.value = v;
  eraserSizeDisplay.textContent = v;
  if (isErasing) drawCtx.lineWidth = v;
});
//ã“ã“ã‹ã‚‰æãã‚ˆï¼
  //æŠ¼ã•ã‚ŒãŸæ™‚ã«æ›¸ã„ã¦ã‚‹ã‚ˆã¨ãƒ•ãƒ©ã‚°ã‚’ç«‹ã¦ã‚‹
drawCanvas.addEventListener("mousedown", (e) => {
  isDrawing = true;
  [lastX, lastY] = [e.offsetX, e.offsetY];
});
//ãƒã‚¦ã‚¹ãŒå‹•ã„ã¦ã‚‹æ™‚å¸¸ã«ï¼ˆãƒ•ãƒ©ã‚°ãŒç«‹ã£ã¦ã„ã‚‹æ™‚ã«isdrawingã§é™å®šï¼‰
drawCanvas.addEventListener("mousemove", (e) => {
  //ã‚«ãƒ¼ã‚½ãƒ«ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
  // â‘  ã¾ãšå‰å›ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æ¶ˆã™
  cursorCtx.clearRect(0, 0, cursorCanvas.width, cursorCanvas.height);
  // â‘¡ ç¾åœ¨ã®ãƒ¢ãƒ¼ãƒ‰ã¨ã‚µã‚¤ã‚ºã‚’å–å¾—
  const size = isErasing
    ? parseInt(eraserWidthSlider.value, 10)
    : parseInt(brushWidthSlider.value, 10);
  const x = e.offsetX, y = e.offsetY;
  // â‘¢ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¨­å®š
  cursorCtx.lineWidth   = 1;
  if (isErasing) {
    // æ¶ˆã—ã‚´ãƒ ãƒ¢ãƒ¼ãƒ‰ï¼šåŠé€æ˜ã‚°ãƒ¬ãƒ¼ã§æ ã ã‘
    cursorCtx.strokeStyle = "rgba(0,0,0,0.3)";
  } else {
    // ãƒšãƒ³ãƒ¢ãƒ¼ãƒ‰ï¼šä»Šã®ç·šè‰²ï¼ˆä¸é€æ˜åº¦è¾¼ã¿ï¼‰ã‚’ä½¿ã†
    cursorCtx.strokeStyle = drawCtx.strokeStyle;
  }

  // â‘£ å††ã‚’æã
  cursorCtx.beginPath();
  cursorCtx.arc(x, y, size / 2, 0, Math.PI * 2);
  cursorCtx.stroke();

  //å®Ÿéš›ã®æç”»ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
  //ãƒ•ãƒ©ã‚°ãŒç«‹ã£ã¦ã„ã‚‹ã®ã§æç”»ãŒãªã•ã‚Œã‚‹
  if (!isDrawing) return;
  drawCtx.lineWidth = isErasing ? eraserWidthSlider.value : brushWidthSlider.value;
  drawCtx.beginPath();
//ãƒ–ãƒ©ã‚·å½¢çŠ¶ã®å†ç¢ºèª
  drawCtx.lineCap = "round";
  drawCtx.lineJoin = "round";

  drawCtx.moveTo(lastX, lastY);
  drawCtx.lineTo(e.offsetX, e.offsetY);
  drawCtx.stroke();
  [lastX, lastY] = [e.offsetX, e.offsetY];
});
    //ãƒã‚¦ã‚¹ã‚’é›¢ã™ã¨æ›¸ã„ã¦ãªã„ã‚ˆã«ãªã£ã¦mousemoveãŒç„¡åŠ¹åŒ–ã•ã‚Œã‚‹ã€‚ã‚«ãƒ¼ã‚½ãƒ«ã‚‚æ¶ˆã™
    drawCanvas.addEventListener("mouseup", () => isDrawing = false);
    drawCanvas.addEventListener("mouseleave", () => isDrawing = false);
    drawCanvas.addEventListener("mouseleave", () => {
  cursorCtx.clearRect(0, 0, cursorCanvas.width, cursorCanvas.height);
});

  </script>

  <script>// ã‚«ãƒ©ãƒ¼ãƒ”ãƒƒã‚«ãƒ¼ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã€‚
const colorInput = document.getElementById('color-picker');
const alphaInput = document.getElementById('alpha');
const alphaDisplay = document.getElementById('alpha-display');

// åˆæœŸè‰²è¨­å®š
function updateBrushColor() {
  const hex = colorInput.value;
  const r = parseInt(hex.slice(1, 3), 16);  //16é€²æ•°ã‚’10é€²æ•°ã«å¤‰æ›
  const g = parseInt(hex.slice(3, 5), 16);
  const b = parseInt(hex.slice(5, 7), 16);
  const a = alphaInput.value / 100;

  const rgba = `rgba(${r}, ${g}, ${b}, ${a})`;
  drawCtx.strokeStyle = rgba;
  //document.getElementById("color-preview").style.backgroundColor = rgba;
}

// è‰²ãƒ»ä¸é€æ˜åº¦ã®å¤‰æ›´ã‚¤ãƒ™ãƒ³ãƒˆ
colorInput.addEventListener('input', updateBrushColor);
alphaInput.addEventListener('input', () => {
  alphaDisplay.textContent = alphaInput.value;
  updateBrushColor();
});

// åˆæœŸåŒ–æ™‚ã«1å›å‘¼ã¶
updateBrushColor();

  </script>
<script>  //ã‚­ãƒ£ãƒ³ãƒ‘ã‚¹ã‚µã‚¤ã‚ºã‚’å¤‰æ›´ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
function resizeCanvases() {
  const wrapper = document.getElementById('canvas-wrapper');
  const width = wrapper.clientWidth;
  const height = wrapper.clientHeight;

  const canvases = wrapper.querySelectorAll('canvas');
  canvases.forEach(canvas => {
    canvas.width = width;   // æç”»è§£åƒåº¦ã®è¨­å®šï¼ˆã“ã‚ŒãŒãªã„ã¨ãƒœã‚±ã‚‹ï¼‰
    canvas.height = height;
  });
}
window.addEventListener('load', resizeCanvases);
window.addEventListener('resize', resizeCanvases);


</script>
</body>
</html>